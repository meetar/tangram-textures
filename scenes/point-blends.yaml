# custom point texture blend mode demo

sources:
    mapzen:
        type: TopoJSON
        url: https://tile.mapzen.com/mapzen/vector/v1/all/{z}/{x}/{y}.topojson?api_key=mapzen-PvCT6iP

textures:
    test_sprites:
        url: https://tangrams.github.io/texture-demos/sprite5.png
        sprites:
            sprite1: [0, 0, 32, 32]
            sprite2: [32, 0, 32, 32]

styles:
    blend_points:
        base: points
        texture: test_sprites
        # texture_blend: overlay # TBD?
        shaders:
            blocks:
                color: |
                    // u_texture is an internal reference used here for prototyping,
                    // and not supported as part of the exposed style API
                    // (in other words don't count on its existence for your own styles)
                    color = texture2D(u_texture, v_texcoord); // draw sprite

                    // Photoshop blend modes:
                    vec3 multiply = v_color.rgb * color.rgb;
                    vec3 screen = 1. - (1. - v_color.rgb) * (1. - color.rgb);
                    vec3 overlay = mix(1.0 - 2.0 * (1. - v_color.rgb) * (1.0 - color.rgb), 2.0 * v_color.rgb * color.rgb, step(v_color.rgb, vec3(0.5)));

                    // color.rgb = multiply;
                    color.rgb = screen;
                    // color.rgb = overlay;

layers:
    water:
        data: { source: mapzen }
        draw:
            polygons:
                order: 2
                color: '#353535'
    earth:
        data: { source: mapzen }
        draw:
            polygons:
                order: 1
                color: '#555555'
    landuse:
        data: { source: mapzen }
        draw:
            polygons:
                order: 3
                color: '#666666'
    places:
        data: { source: mapzen }
        draw:
            points:
                style: blend_points
                sprite: sprite1
                color: [1, .5, .5]
                size: 64px
                collide: false
